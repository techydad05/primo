{"version":3,"file":"0-W1KcdPEQ.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/_layout.js","../../../.svelte-kit/adapter-node/entries/pages/_layout.server.js","../../../.svelte-kit/adapter-node/nodes/0.js"],"sourcesContent":["import { P as PUBLIC_SUPABASE_URL, a as PUBLIC_SUPABASE_PUBLIC_KEY } from \"../../chunks/public.js\";\nimport { createSupabaseLoadClient } from \"@supabase/auth-helpers-sveltekit\";\nimport { r as redirect } from \"../../chunks/index.js\";\nasync function load(event) {\n  event.depends(\"supabase:auth\");\n  event.depends(\"app:data\");\n  const supabase = createSupabaseLoadClient({\n    supabaseUrl: PUBLIC_SUPABASE_URL,\n    supabaseKey: PUBLIC_SUPABASE_PUBLIC_KEY,\n    event: { fetch },\n    serverSession: event?.data?.session\n  });\n  const {\n    data: { session }\n  } = await supabase.auth.getSession();\n  if (!session && !event.url.pathname.startsWith(\"/auth\")) {\n    throw redirect(303, \"/auth\");\n  } else if (session) {\n    const { sites, user } = await Promise.all([\n      supabase.from(\"sites\").select(\"id, name, url, active_deployment, collaborators (*)\").order(\"created_at\", { ascending: true }),\n      supabase.from(\"users\").select(\"*, server_members (admin, role), collaborators (role)\").eq(\"id\", session.user.id).single()\n    ]).then(([{ data: sites2 }, { data: user2 }]) => {\n      const [server_member] = user2.server_members;\n      const [collaborator] = user2.collaborators;\n      const user_final = server_member ? {\n        ...user2,\n        server_member: true,\n        admin: server_member.admin,\n        role: server_member.role\n      } : {\n        ...user2,\n        server_member: false,\n        admin: false,\n        role: collaborator.role\n      };\n      return {\n        sites: sites2 || [],\n        user: user_final\n      };\n    });\n    const user_sites = sites?.filter(\n      (site) => (\n        /*user is server member*/\n        user.server_member || /*user is site collaborator*/\n        site.collaborators.some(\n          (collaborator) => collaborator.user === user.id\n        )\n      )\n    );\n    return {\n      supabase,\n      session,\n      user,\n      sites: user_sites\n    };\n  }\n}\nexport {\n  load\n};\n//# sourceMappingURL=_layout.js.map\n","import { r as redirect } from \"../../chunks/index.js\";\nconst load = async ({ url, locals: { supabase, getSession } }) => {\n  const { data: symbol } = await supabase.from(\"symbols\").select(\"index\").limit(1);\n  if (url.pathname !== \"/update-notice\" && url.pathname !== \"/auth\") {\n    if (!symbol) {\n      throw redirect(303, \"/update-notice?alert=missing-symbol-index\");\n    }\n  } else if (url.pathname === \"/update-notice\") {\n    if (symbol && url.searchParams.get(\"alert\") === \"missing-symbol-index\") {\n      throw redirect(303, \"/\");\n    }\n  }\n  return {\n    session: await getSession()\n  };\n};\nexport {\n  load\n};\n//# sourceMappingURL=_layout.server.js.map\n","import * as universal from '../entries/pages/_layout.js';\nimport * as server from '../entries/pages/_layout.server.js';\n\nexport const index = 0;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/_layout.svelte.js')).default;\nexport { universal };\nexport const universal_id = \"src/routes/+layout.js\";\nexport { server };\nexport const server_id = \"src/routes/+layout.server.js\";\nexport const imports = [\"_app/immutable/nodes/0.42d910ab.js\",\"_app/immutable/chunks/Modal.c2829365.js\",\"_app/immutable/chunks/index.7ce6af5d.js\",\"_app/immutable/chunks/singletons.d2d14c82.js\",\"_app/immutable/chunks/index.ffa02d79.js\",\"_app/immutable/chunks/stores.fb720b2c.js\",\"_app/immutable/chunks/navigation.2516ba35.js\",\"_app/immutable/chunks/utils.78dc49a2.js\",\"_app/immutable/chunks/Page.svelte_svelte_type_style_lang.5ee686e0.js\",\"_app/immutable/chunks/preload-helper.a4192956.js\",\"_app/immutable/chunks/converter.1113586f.js\",\"_app/immutable/chunks/index.ade5cbd2.js\",\"_app/immutable/chunks/control.f5b05b5f.js\"];\nexport const stylesheets = [\"_app/immutable/assets/0.13fe9c06.css\",\"_app/immutable/assets/Modal.bc3e6364.css\",\"_app/immutable/assets/Page.c37a3656.css\",\"_app/immutable/assets/CodeMirror.f33dab8f.css\"];\nexport const fonts = [\"_app/immutable/assets/fira-code-cyrillic-ext-400-normal.aeaf7f0a.woff2\",\"_app/immutable/assets/fira-code-cyrillic-ext-400-normal.96b1b870.woff\",\"_app/immutable/assets/fira-code-cyrillic-400-normal.dac6dde5.woff2\",\"_app/immutable/assets/fira-code-cyrillic-400-normal.b0cb6f39.woff\",\"_app/immutable/assets/fira-code-greek-ext-400-normal.9abd2774.woff2\",\"_app/immutable/assets/fira-code-greek-ext-400-normal.8c540835.woff\",\"_app/immutable/assets/fira-code-greek-400-normal.ab9177a1.woff2\",\"_app/immutable/assets/fira-code-greek-400-normal.f70ef159.woff\",\"_app/immutable/assets/fira-code-latin-ext-400-normal.5e162e63.woff2\",\"_app/immutable/assets/fira-code-latin-ext-400-normal.315dc11c.woff\",\"_app/immutable/assets/fira-code-latin-400-normal.2b407eb4.woff2\",\"_app/immutable/assets/fira-code-latin-400-normal.59bca7e3.woff\"];\n"],"names":["load"],"mappings":";;;;AAGA,eAAeA,MAAI,CAAC,KAAK,EAAE;AAC3B,EAAE,KAAK,CAAC,OAAO,CAAC,eAAe,CAAC;AAChC,EAAE,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC;AAC3B,EAAE,MAAM,QAAQ,GAAG,wBAAwB,CAAC;AAC5C,IAAI,WAAW,EAAE,mBAAmB;AACpC,IAAI,WAAW,EAAE,0BAA0B;AAC3C,IAAI,KAAK,EAAE,EAAE,KAAK,EAAE;AACpB,IAAI,aAAa,EAAE,KAAK,EAAE,IAAI,EAAE;AAChC,GAAG,CAAC;AACJ,EAAE,MAAM;AACR,IAAI,IAAI,EAAE,EAAE,OAAO;AACnB,GAAG,GAAG,MAAM,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE;AACtC,EAAE,IAAI,CAAC,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE;AAC3D,IAAI,MAAM,QAAQ,CAAC,GAAG,EAAE,OAAO,CAAC;AAChC,GAAG,MAAM,IAAI,OAAO,EAAE;AACtB,IAAI,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;AAC9C,MAAM,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,MAAM,CAAC,qDAAqD,CAAC,CAAC,KAAK,CAAC,YAAY,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC;AACnI,MAAM,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,MAAM,CAAC,uDAAuD,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,MAAM;AAC7H,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,EAAE,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,KAAK;AACrD,MAAM,MAAM,CAAC,aAAa,CAAC,GAAG,KAAK,CAAC,cAAc;AAClD,MAAM,MAAM,CAAC,YAAY,CAAC,GAAG,KAAK,CAAC,aAAa;AAChD,MAAM,MAAM,UAAU,GAAG,aAAa,GAAG;AACzC,QAAQ,GAAG,KAAK;AAChB,QAAQ,aAAa,EAAE,IAAI;AAC3B,QAAQ,KAAK,EAAE,aAAa,CAAC,KAAK;AAClC,QAAQ,IAAI,EAAE,aAAa,CAAC;AAC5B,OAAO,GAAG;AACV,QAAQ,GAAG,KAAK;AAChB,QAAQ,aAAa,EAAE,KAAK;AAC5B,QAAQ,KAAK,EAAE,KAAK;AACpB,QAAQ,IAAI,EAAE,YAAY,CAAC;AAC3B,OAAO;AACP,MAAM,OAAO;AACb,QAAQ,KAAK,EAAE,MAAM,IAAI,EAAE;AAC3B,QAAQ,IAAI,EAAE;AACd,OAAO;AACP,KAAK,CAAC;AACN,IAAI,MAAM,UAAU,GAAG,KAAK,EAAE,MAAM;AACpC,MAAM,CAAC,IAAI;AACX;AACA,QAAQ,IAAI,CAAC,aAAa;AAC1B,QAAQ,IAAI,CAAC,aAAa,CAAC,IAAI;AAC/B,UAAU,CAAC,YAAY,KAAK,YAAY,CAAC,IAAI,KAAK,IAAI,CAAC;AACvD;AACA;AACA,KAAK;AACL,IAAI,OAAO;AACX,MAAM,QAAQ;AACd,MAAM,OAAO;AACb,MAAM,IAAI;AACV,MAAM,KAAK,EAAE;AACb,KAAK;AACL;AACA;;;;;;;ACvDA,MAAM,IAAI,GAAG,OAAO,EAAE,GAAG,EAAE,MAAM,EAAE,EAAE,QAAQ,EAAE,UAAU,EAAE,EAAE,KAAK;AAClE,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,MAAM,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;AAClF,EAAE,IAAI,GAAG,CAAC,QAAQ,KAAK,gBAAgB,IAAI,GAAG,CAAC,QAAQ,KAAK,OAAO,EAAE;AACrE,IAAI,IAAI,CAAC,MAAM,EAAE;AACjB,MAAM,MAAM,QAAQ,CAAC,GAAG,EAAE,2CAA2C,CAAC;AACtE;AACA,GAAG,MAAM,IAAI,GAAG,CAAC,QAAQ,KAAK,gBAAgB,EAAE;AAChD,IAAI,IAAI,MAAM,IAAI,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,sBAAsB,EAAE;AAC5E,MAAM,MAAM,QAAQ,CAAC,GAAG,EAAE,GAAG,CAAC;AAC9B;AACA;AACA,EAAE,OAAO;AACT,IAAI,OAAO,EAAE,MAAM,UAAU;AAC7B,GAAG;AACH,CAAC;;;;;;;ACZW,MAAC,KAAK,GAAG;AACrB,IAAI,eAAe;AACP,MAAC,SAAS,GAAG,YAAY,eAAe,KAAK,CAAC,MAAM,OAAO,8BAAoC,CAAC,EAAE;AAElG,MAAC,YAAY,GAAG;AAEhB,MAAC,SAAS,GAAG;AACb,MAAC,OAAO,GAAG,CAAC,oCAAoC,CAAC,yCAAyC,CAAC,yCAAyC,CAAC,8CAA8C,CAAC,yCAAyC,CAAC,0CAA0C,CAAC,8CAA8C,CAAC,yCAAyC,CAAC,sEAAsE,CAAC,kDAAkD,CAAC,6CAA6C,CAAC,yCAAyC,CAAC,2CAA2C;AAC/lB,MAAC,WAAW,GAAG,CAAC,sCAAsC,CAAC,0CAA0C,CAAC,yCAAyC,CAAC,+CAA+C;AAC3L,MAAC,KAAK,GAAG,CAAC,wEAAwE,CAAC,uEAAuE,CAAC,oEAAoE,CAAC,mEAAmE,CAAC,qEAAqE,CAAC,oEAAoE,CAAC,iEAAiE,CAAC,gEAAgE,CAAC,qEAAqE,CAAC,oEAAoE,CAAC,iEAAiE,CAAC,gEAAgE;;;;"}