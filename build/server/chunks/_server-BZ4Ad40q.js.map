{"version":3,"file":"_server-BZ4Ad40q.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/_site_/_page_.html/_server.js"],"sourcesContent":["import { r as redirect } from \"../../../../chunks/index.js\";\nimport { s as supabase_admin } from \"../../../../chunks/admin.js\";\nimport { p as postcss, h as html_server } from \"../../../../chunks/server-postcss.js\";\nimport { g as getPageData, a as get_content_with_static } from \"../../../../chunks/Page.svelte_svelte_type_style_lang.js\";\nimport \"../../../../chunks/Icon.js\";\nimport \"mousetrap\";\nimport \"axios\";\nimport \"file-saver\";\nimport \"autosize\";\nconst GET = async (event) => {\n  const { url } = event;\n  if (url.pathname.includes(\".html\")) {\n    const site_url = event.params[\"site\"];\n    const [parent_url = \"index\", child_url] = event.params[\"page\"]?.split(\"/\") ?? [];\n    const page_url = child_url ?? parent_url;\n    const [{ data: site }, { data: page }] = await Promise.all([\n      supabase_admin.from(\"sites\").select(\"*\").filter(\"url\", \"eq\", site_url).single(),\n      supabase_admin.from(\"pages\").select(\"*, site!inner(url)\").match({ \"site.url\": site_url, url: page_url }).single()\n    ]);\n    console.log({ site, page, page_url });\n    if (!site)\n      ;\n    else if (!page && page_url !== \"index\") {\n      throw redirect(303, `/${site_url}/index`);\n    }\n    const [{ data: symbols }, { data: sections }] = await Promise.all([\n      supabase_admin.from(\"symbols\").select().match({ site: site.id }).order(\"created_at\", { ascending: false }),\n      supabase_admin.from(\"sections\").select(\"id, page, index, content, symbol\").match({ page: page[\"id\"] }).order(\"index\", { ascending: true })\n    ]);\n    const locale = \"en\";\n    const component = await Promise.all([\n      (async () => {\n        const css = await postcss(site.code.css + page.code.css);\n        const data = getPageData({ page, site, loc: locale });\n        return {\n          html: `\n\t\t\t      <svelte:head>\n\t\t\t        ${site.code.html.head}\n\t\t\t        ${page.code.html.head}\n\t\t\t        <style>${css}</style>\n\t\t\t      </svelte:head>`,\n          css: ``,\n          js: ``,\n          data\n        };\n      })(),\n      ...sections.map(async (section) => {\n        const symbol = symbols.find((symbol2) => symbol2.id === section.symbol);\n        const { html, css: rawcss, js } = symbol.code;\n        const data = get_content_with_static({\n          component: section,\n          symbol,\n          loc: locale\n        });\n        const css = await postcss(rawcss || \"\");\n        const section_id = section.id.split(\"-\")[0];\n        return {\n          html: `\n\t\t        <div class=\"section\" id=\"section-${section_id}\">\n\t\t          ${html}\n\t\t        </div>`,\n          js,\n          css: css || \"\",\n          data\n        };\n      }).filter(Boolean),\n      // remove options blocks\n      (async () => {\n        const data = getPageData({ page, site, loc: locale });\n        return {\n          html: site.code.html.below + page.code.html.below,\n          css: ``,\n          js: ``,\n          data\n        };\n      })()\n    ]);\n    const res = await html_server({\n      component\n    });\n    const final = `  <!DOCTYPE html>\n  <html lang=\"${locale}\">\n    <head>\n      <meta name=\"generator\" content=\"Primo\" />\n      ${res.head}\n      <style>${res.css}</style>\n    </head>\n    <body id=\"page\">\n      ${res.html}\n    </body>\n  </html>\n  `;\n    return new Response(final, {\n      status: 200,\n      headers: {\n        \"Content-Type\": \"text/html\"\n      }\n    });\n  }\n};\nexport {\n  GET\n};\n//# sourceMappingURL=_server.js.map\n"],"names":[],"mappings":"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"}