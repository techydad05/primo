{"version":3,"file":"_server-xmcAE8x_.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/deploy/blobs/_server.js"],"sourcesContent":["import { e as error, j as json } from \"../../../../../chunks/index.js\";\nimport { s as supabase_admin } from \"../../../../../chunks/admin.js\";\nimport axios from \"axios\";\nasync function POST({ request, locals }) {\n  const session = await locals.getSession();\n  if (!session) {\n    throw error(401, { message: \"Unauthorized\" });\n  }\n  const { repo_name, files, provider } = await request.json();\n  const { data: token } = await supabase_admin.from(\"config\").select(\"value\").eq(\"id\", `${provider}_token`).single();\n  const res = await Promise.all(\n    files.map(async (file) => {\n      const blob_sha = await create_blob({\n        content: file.data,\n        token: token?.value,\n        repo_name\n      });\n      return {\n        path: file.file,\n        sha: blob_sha\n      };\n    })\n  );\n  return json(res);\n}\nasync function create_blob({ content, repo_name, token }) {\n  const { data } = await axios.post(\n    `https://api.github.com/repos/${repo_name}/git/blobs`,\n    {\n      content,\n      encoding: \"utf-8\"\n    },\n    {\n      headers: { Authorization: `Bearer ${token}` }\n    }\n  );\n  return data.sha;\n}\nexport {\n  POST\n};\n//# sourceMappingURL=_server.js.map\n"],"names":[],"mappings":";;;;;;AAGA,eAAe,IAAI,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,EAAE;AACzC,EAAE,MAAM,OAAO,GAAG,MAAM,MAAM,CAAC,UAAU,EAAE;AAC3C,EAAE,IAAI,CAAC,OAAO,EAAE;AAChB,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,cAAc,EAAE,CAAC;AACjD;AACA,EAAE,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE;AAC7D,EAAE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,EAAE;AACpH,EAAE,MAAM,GAAG,GAAG,MAAM,OAAO,CAAC,GAAG;AAC/B,IAAI,KAAK,CAAC,GAAG,CAAC,OAAO,IAAI,KAAK;AAC9B,MAAM,MAAM,QAAQ,GAAG,MAAM,WAAW,CAAC;AACzC,QAAQ,OAAO,EAAE,IAAI,CAAC,IAAI;AAC1B,QAAQ,KAAK,EAAE,KAAK,EAAE,KAAK;AAC3B,QAAQ;AACR,OAAO,CAAC;AACR,MAAM,OAAO;AACb,QAAQ,IAAI,EAAE,IAAI,CAAC,IAAI;AACvB,QAAQ,GAAG,EAAE;AACb,OAAO;AACP,KAAK;AACL,GAAG;AACH,EAAE,OAAO,IAAI,CAAC,GAAG,CAAC;AAClB;AACA,eAAe,WAAW,CAAC,EAAE,OAAO,EAAE,SAAS,EAAE,KAAK,EAAE,EAAE;AAC1D,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,KAAK,CAAC,IAAI;AACnC,IAAI,CAAC,6BAA6B,EAAE,SAAS,CAAC,UAAU,CAAC;AACzD,IAAI;AACJ,MAAM,OAAO;AACb,MAAM,QAAQ,EAAE;AAChB,KAAK;AACL,IAAI;AACJ,MAAM,OAAO,EAAE,EAAE,aAAa,EAAE,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;AACjD;AACA,GAAG;AACH,EAAE,OAAO,IAAI,CAAC,GAAG;AACjB;;;;"}