import{c as U,P as N,a as j,M as D,s as L}from"../chunks/Modal.c2829365.js";import{r as B}from"../chunks/index.ade5cbd2.js";import{_ as $}from"../chunks/preload-helper.a4192956.js";import{S as I,i as M,s as K,C as z,y as J,a as R,z as F,c as G,A as W,b as H,D as q,E as V,F as X,g as S,d as k,B as Y,h as Q,o as Z,G as O}from"../chunks/index.7ce6af5d.js";import{l as ee,e as te,i as re}from"../chunks/navigation.2516ba35.js";import{r as oe}from"../chunks/Page.svelte_svelte_type_style_lang.5ee686e0.js";new TextEncoder;const ae=new TextDecoder,ne=t=>{const e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r},ie=t=>{let e=t;e instanceof Uint8Array&&(e=ae.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return ne(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}},se=ie;var ce=Object.create,C=Object.defineProperty,le=Object.getOwnPropertyDescriptor,P=Object.getOwnPropertyNames,ue=Object.getPrototypeOf,pe=Object.prototype.hasOwnProperty,de=(t,e)=>function(){return e||(0,t[P(t)[0]])((e={exports:{}}).exports,e),e.exports},fe=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of P(e))!pe.call(t,s)&&s!==r&&C(t,s,{get:()=>e[s],enumerable:!(n=le(e,s))||n.enumerable});return t},E=(t,e,r)=>(r=t!=null?ce(ue(t)):{},fe(e||!t||!t.__esModule?C(r,"default",{value:t,enumerable:!0}):r,t)),A=de({"../../node_modules/.pnpm/cookie@0.5.0/node_modules/cookie/index.js"(t){t.parse=n,t.serialize=s;var e=Object.prototype.toString,r=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function n(a,d){if(typeof a!="string")throw new TypeError("argument str must be a string");for(var m={},l=d||{},g=l.decode||i,f=0;f<a.length;){var p=a.indexOf("=",f);if(p===-1)break;var _=a.indexOf(";",f);if(_===-1)_=a.length;else if(_<p){f=a.lastIndexOf(";",p-1)+1;continue}var h=a.slice(f,p).trim();if(m[h]===void 0){var v=a.slice(p+1,_).trim();v.charCodeAt(0)===34&&(v=v.slice(1,-1)),m[h]=u(v,g)}f=_+1}return m}function s(a,d,m){var l=m||{},g=l.encode||o;if(typeof g!="function")throw new TypeError("option encode is invalid");if(!r.test(a))throw new TypeError("argument name is invalid");var f=g(d);if(f&&!r.test(f))throw new TypeError("argument val is invalid");var p=a+"="+f;if(l.maxAge!=null){var _=l.maxAge-0;if(isNaN(_)||!isFinite(_))throw new TypeError("option maxAge is invalid");p+="; Max-Age="+Math.floor(_)}if(l.domain){if(!r.test(l.domain))throw new TypeError("option domain is invalid");p+="; Domain="+l.domain}if(l.path){if(!r.test(l.path))throw new TypeError("option path is invalid");p+="; Path="+l.path}if(l.expires){var h=l.expires;if(!c(h)||isNaN(h.valueOf()))throw new TypeError("option expires is invalid");p+="; Expires="+h.toUTCString()}if(l.httpOnly&&(p+="; HttpOnly"),l.secure&&(p+="; Secure"),l.priority){var v=typeof l.priority=="string"?l.priority.toLowerCase():l.priority;switch(v){case"low":p+="; Priority=Low";break;case"medium":p+="; Priority=Medium";break;case"high":p+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(l.sameSite){var x=typeof l.sameSite=="string"?l.sameSite.toLowerCase():l.sameSite;switch(x){case!0:p+="; SameSite=Strict";break;case"lax":p+="; SameSite=Lax";break;case"strict":p+="; SameSite=Strict";break;case"none":p+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return p}function i(a){return a.indexOf("%")!==-1?decodeURIComponent(a):a}function o(a){return encodeURIComponent(a)}function c(a){return e.call(a)==="[object Date]"||a instanceof Date}function u(a,d){try{return d(a)}catch{return a}}}}),b=E(A()),T=E(A());function _e(t){if(!t)return null;try{const e=JSON.parse(t);if(!e)return null;if(e.constructor.name==="Object")return e;if(e.constructor.name!=="Array")throw new Error(`Unexpected format: ${e.constructor.name}`);const[r,n,s]=e[0].split("."),i=se(n),o=new TextDecoder,{exp:c,sub:u,...a}=JSON.parse(o.decode(i));return{expires_at:c,expires_in:c-Math.round(Date.now()/1e3),token_type:"bearer",access_token:e[0],refresh_token:e[1],provider_token:e[2],provider_refresh_token:e[3],user:{id:u,factors:e[4],...a}}}catch(e){return console.warn("Failed to parse cookie string:",e),null}}function me(t){var e;return JSON.stringify([t.access_token,t.refresh_token,t.provider_token,t.provider_refresh_token,((e=t.user)==null?void 0:e.factors)??null])}function y(){return typeof window<"u"&&typeof window.document<"u"}var he={path:"/",maxAge:60*60*24*365*1e3},ve=class{constructor(t){this.cookieOptions={...he,...t}}getItem(t){const e=this.getCookie(t);return e?t.endsWith("-code-verifier")?e:JSON.stringify(_e(e)):null}setItem(t,e){if(t.endsWith("-code-verifier")){this.setCookie(t,e);return}let r=JSON.parse(e);const n=me(r);this.setCookie(t,n)}removeItem(t){this.deleteCookie(t)}},ye=class extends ve{constructor(t){super(t)}getCookie(t){return y()?(0,b.parse)(document.cookie)[t]:null}setCookie(t,e){if(!y())return null;document.cookie=(0,b.serialize)(t,e,{...this.cookieOptions,httpOnly:!1})}deleteCookie(t){if(!y())return null;document.cookie=(0,b.serialize)(t,"",{...this.cookieOptions,maxAge:0,httpOnly:!1})}};function ge(t,e,r){var n;const s=y();return U(t,e,{...r,auth:{flowType:"pkce",autoRefreshToken:s,detectSessionInUrl:s,persistSession:!0,storage:r.auth.storage,...(n=r.auth)!=null&&n.storageKey?{storageKey:r.auth.storageKey}:{}}})}T.parse;T.serialize;/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var be=class extends ye{constructor(t=null,e){super(e),this.serverSession=t}getItem(t){return y()?super.getItem(t):JSON.stringify(this.serverSession)}},w;function we({supabaseUrl:t,supabaseKey:e,event:r,serverSession:n,options:s,cookieOptions:i}){var o;const c=y();if(c&&w)return w;const u=ge(t,e,{...s,global:{fetch:r.fetch,...s==null?void 0:s.global,headers:{...(o=s==null?void 0:s.global)==null?void 0:o.headers,"X-Client-Info":"@supabase/auth-helpers-sveltekit@0.10.2"}},auth:{storageKey:i==null?void 0:i.name,storage:new be(n,i)}});return c&&(w=u),u}async function Se(t){var n;t.depends("supabase:auth"),t.depends("app:data");const e=we({supabaseUrl:N,supabaseKey:j,event:{fetch},serverSession:(n=t==null?void 0:t.data)==null?void 0:n.session}),{data:{session:r}}=await e.auth.getSession();if(!r&&!t.url.pathname.startsWith("/auth"))throw B(303,"/auth");if(r){const{sites:s,user:i}=await Promise.all([e.from("sites").select("id, name, url, active_deployment, collaborators (*)").order("created_at",{ascending:!0}),e.from("users").select("*, server_members (admin, role), collaborators (role)").eq("id",r.user.id).single()]).then(([{data:c},{data:u}])=>{const[a]=u.server_members,[d]=u.collaborators,m=a?{...u,server_member:!0,admin:a.admin,role:a.role}:{...u,server_member:!1,admin:!1,role:d.role};return{sites:c||[],user:m}}),o=s==null?void 0:s.filter(c=>i.server_member||c.collaborators.some(u=>u.user===i.id));return{supabase:e,session:r,user:i,sites:o}}}const Ue=Object.freeze(Object.defineProperty({__proto__:null,load:Se},Symbol.toStringTag,{value:"Module"}));function ke(t){let e,r,n;e=new D({});const s=t[3].default,i=z(s,t,t[2],null);return{c(){J(e.$$.fragment),r=R(),i&&i.c()},l(o){F(e.$$.fragment,o),r=G(o),i&&i.l(o)},m(o,c){W(e,o,c),H(o,r,c),i&&i.m(o,c),n=!0},p(o,[c]){i&&i.p&&(!n||c&4)&&q(i,s,o,o[2],n?X(s,o[2],c,null):V(o[2]),null)},i(o){n||(S(e.$$.fragment,o),S(i,o),n=!0)},o(o){k(e.$$.fragment,o),k(i,o),n=!1},d(o){Y(e,o),o&&Q(r),i&&i.d(o)}}}function Oe(t,e,r){let{$$slots:n={},$$scope:s}=e,{data:i}=e,{supabase:o,session:c}=i;return Z(()=>{if(!o)return;const{data:{subscription:u}}=o.auth.onAuthStateChange((a,d)=>{(d==null?void 0:d.expires_at)!==(c==null?void 0:c.expires_at)&&re("supabase:auth")});return()=>u.unsubscribe()}),$(()=>import("../chunks/processors.e799ac8a.js"),["../chunks/processors.e799ac8a.js","../chunks/preload-helper.a4192956.js","../chunks/Page.svelte_svelte_type_style_lang.5ee686e0.js","../chunks/index.7ce6af5d.js","../chunks/index.ffa02d79.js","../chunks/navigation.2516ba35.js","../chunks/singletons.d2d14c82.js","../chunks/stores.fb720b2c.js","../assets/Page.c37a3656.css"],import.meta.url).then(({html:u,css:a})=>{oe({html:u,css:a})}),O("track",()=>{}),O("DEBUGGING",new URLSearchParams(window.location.search).has("debug")),ee(["gg:spinner","material-symbols:edit-square-outline-rounded","pepicons-pop:trash","gridicons:external"]),te("local"),t.$$set=u=>{"data"in u&&r(0,i=u.data),"$$scope"in u&&r(2,s=u.$$scope)},t.$$.update=()=>{t.$$.dirty&1&&r(1,{supabase:o,session:c}=i,c),t.$$.dirty&2&&c&&L.auth.setSession({access_token:c.access_token,refresh_token:c.refresh_token})},[i,c,s,n]}class Ne extends I{constructor(e){super(),M(this,e,Oe,ke,K,{data:0})}}export{Ne as component,Ue as universal};
//# sourceMappingURL=0.42d910ab.js.map
